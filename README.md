# SmartGate
* 라즈베리파이기반 tensorflow와 openCV를 이용한 마스크인식과 체온을 측정하여 출입문을 열고 닫는 작품을 만드는 프로젝트입니다.
* 라즈베리파이 환경에서 작동하는 코드입니다. 서보모터, 온도센서 등의 라이브러리가 포함되어 있어 PC에선 작동하지 않습니다

# flow chatrt
![image](https://user-images.githubusercontent.com/96603945/163541089-a0453ab1-0a8e-42d3-ac53-0a594bd72641.png)

# 전체 기능 흐름
![image](https://user-images.githubusercontent.com/96603945/163541167-1a1f6321-fd6b-4412-909c-17816c12b520.png)

1. 사용자는 기기 앞 가이드라인 위에 선다.
2. 카메라를 응시하며 마스크 인식과 온도체크가 끝날 때까지 기다린다.
3. 스피커를 통해 출력되는 음성안내의 지시에 따라 행동한다. <br/>
(온도 재측정 요구 시) : 모니터를 통해 자신의 온도를 확인하고 자신의 얼굴이 화면 가운데에 위치할 수 있도록 조정한다.
4. 출입문이 열리면 통과하여 건물 내부로 입장한다.

# 기능
### 얼굴 인식 및 마스크 인식
![image](https://user-images.githubusercontent.com/96603945/163542157-1448dcf3-ab1f-4c95-b785-e2b7f1c8c0d1.png)
* openCV와 Tensorflow를 사용한 얼굴 인식을 기반으로 한 마스크 인식모델을 학습한 인공지능 모델로 사용자의 마스크 착용 유무를 판별한다.

### 열 측정 기능
![image](https://user-images.githubusercontent.com/96603945/163542215-31555b20-bb4d-436a-9ea0-e3cecdf238df.png)
* mlx-90614 적외선 온도 센서를 사용하여 사용자의 이마 부분의 체온을 측정하여 열이 제대로 측정이 됐는지, 정상온도인지 고열인지를 판단한다.

### 메인보드 기능
![image](https://user-images.githubusercontent.com/96603945/163542256-e59f4b88-8308-4692-87ec-e987e8866ba6.png)
* 카메라와 온도 센서를 통해 얻은 정보를 종합하여 사용자의 건물 출입 가능 유무를 결정한다. 
* 사용자의 출입 가능 유무의 결정에 따라서 출입문에 열림(open) 또는 닫힘(close) 신호를 보내고 스피커를 통해 각각 상황에 맞는 음성안내를 출력하는 신호를 보낸다.

### 출입문 기능
![image](https://user-images.githubusercontent.com/96603945/163542324-dcd6aa2b-1675-4455-8147-cdff51ed4169.png)
* 메인보드에서 보내는 신호에 따라 움직이는(open 또는 close) 출입문 실질적으로 감염의 보균 위험자를 통제하며 내부 감염의 위험을 막는 기능 
* (본 작품에서는 소형모형으로 대체하여 이 기능을 구현했습니다)

### 음성 출력 기능
![image](https://user-images.githubusercontent.com/96603945/163542391-c3031b09-a060-4c1e-9411-4bd9b0ab86a4.png)
* 스피커를 사용하여 사용자의 진행 단계 및 위험상태를 음성으로 안내하고 사용자가 다음 단계로 진행하도록 유도해주는 기능

### 화면 출력 기능
![image](https://user-images.githubusercontent.com/96603945/163542421-6ddaee1e-2ac9-4be8-8433-dbae660bbbeb.png)
* 현재 진행상태를 모니터에 출력하고 사용자의 마스크 착용의 여부와 온도를 출력하여 사용자가 자신의 상태를 확인하여 작품 사용에 용이 하도록 유도해준다.

# 트러블 슈팅
* mlx90614는 비거리의 따라서 측정하는 물체의 범위(fov)가 커지기 때문에 거리가 멀어질수록 정확도가 급격히 떨어진다. 
* 따라서 일정한 온도측정이 가능한 비거리를 측정하여 그 위치에 사용자를 유도하는 방법을 사용하였다.
* 최적의 위치 : 온도 센서를 높이 160cm, 사용자의 거리 40cm에서 일정한 값이 나오는 것을 확인할 수 있었다.
* 이러한 실험 결과의 온도 센서의 측정값을 바탕으로 37.5도 이상 고열, 35도 이하 시 재측정 요구하는 프로세스를 수행하게 된다.

